<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"/>
  <title>N√ñ ‚Ä¢ 14-Tage-Niederschlag</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin>
  <style>
    html,body,#map{height:100%;margin:0}
    .ui{position:absolute;z-index:1000;background:#fff;padding:6px 10px;border-radius:6px;box-shadow:0 1px 4px rgba(0,0,0,.3);font-family:system-ui}
    #loc{top:12px;left:12px} #op{top:12px;right:12px}
    label{font-size:12px}
  </style>
</head>
<body>
  <div id="map"></div>
  <button class="ui" id="loc">üìç Meine Position</button>
  <div class="ui" id="op"><label>Overlay <input type="range" id="opacity" min="30" max="100" value="85"> <span id="ovv">85%</span></label></div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin></script>
  <script>
  (function(){
    // <<< HIER anpassen
    const PNG_URL = "noe_rr_sum_2025-08-14_bis_2025-08-27.png";
    const bounds = { south: 47.399564822, west: 14.430844322, north: 49.044548178, east: 17.095640678 };
    // >>>>>

    const map = L.map('map', { zoomControl: true });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19,attribution:'&copy; OpenStreetMap'}).addTo(map);

    const imgBounds = L.latLngBounds([bounds.south,bounds.west],[bounds.north,bounds.east]);
    const overlay = L.imageOverlay(PNG_URL, imgBounds, {opacity:0.85}).addTo(map);
    map.fitBounds(imgBounds.pad(0.1));

    // Opacity UI
    const op = document.getElementById('opacity'), ovv = document.getElementById('ovv');
    const up = ()=>{ const v = Number(op.value)/100; overlay.setOpacity(v); ovv.textContent = `${op.value}%`; };
    op.addEventListener('input', up); up();

    // GPS (funktioniert auf Pages/HTTPS, nach Berechtigung)
    const btn = document.getElementById('loc'); let watchId=null, marker=null;
    btn.addEventListener('click', ()=>{
      if(!navigator.geolocation){ alert("Geolocation nicht verf√ºgbar."); return; }
      if(watchId===null){
        watchId = navigator.geolocation.watchPosition(p=>{
          const {latitude, longitude} = p.coords;
          if(!marker){ marker = L.marker([latitude,longitude]).addTo(map).bindPopup("Du bist hier"); }
          marker.setLatLng([latitude,longitude]);
        }, e=>alert("GPS-Fehler: "+e.message), {enableHighAccuracy:true,maximumAge:10000,timeout:15000});
        btn.textContent = "üìç GPS aktiv";
      } else {
        navigator.geolocation.clearWatch(watchId); watchId=null;
        if(marker){ map.removeLayer(marker); marker=null; }
        btn.textContent = "üìç Meine Position";
      }
    });
  })();
  </script>
</body>
</html>
